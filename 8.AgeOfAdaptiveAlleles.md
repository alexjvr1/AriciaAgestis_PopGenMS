# Estimate divergence time between adaptive loci 


https://helda.helsinki.fi/bitstream/handle/10138/298668/journal.pgen.1007796.pdf?sequence=1&isAllowed=y


Here I aim to test: 

1) age of the outlier loci

2) origin of the outlier loci 


## fineRADstructure of outlier loci

fineRADstructure looks at the recent coancestry of loci. I can rerun this analysis using only the outlier loci identified by Bayescan. 


Filter vcf file for scaffolds that contain the outlier loci: 

HostPlant
```
/Users/alexjvr/2018.postdoc/BrownArgus_2018/201902_DataAnalysis/fineRADstructure

vcftools --vcf AA261.newnames.vcf --chr contig_5345 --chr contig_17378 --chr contig_5407 --chr contig_19343 --chr contig_3838 --chr contig_2518 --chr m_scaff_962 --chr contig_11951 --recode --recode-INFO-all --out AA261.HostPlantOutlierScaffolds

VCFtools - v0.1.14
(C) Adam Auton and Anthony Marcketta 2009

Parameters as interpreted:
	--vcf AA261.newnames.vcf
	--chr contig_11951
	--chr contig_17378
	--chr contig_19343
	--chr contig_2518
	--chr contig_3838
	--chr contig_5345
	--chr contig_5407
	--chr m_scaff_962
	--recode-INFO-all
	--out AA261.HostPlantOutlierScaffolds
	--recode

After filtering, kept 261 out of 261 Individuals
Outputting VCF file...
After filtering, kept 109 out of a possible 31381 Sites
Run Time = 4.00 seconds


## Keep only individuals genotyped at more than 50% of the loci
vcftools --vcf AA261.HostPlantOutlierScaffolds.recode.vcf --keep keep.HostPlant --recode --recode-INFO-all --out AA250.HostPlantOutlierScaffolds

VCFtools - v0.1.14
(C) Adam Auton and Anthony Marcketta 2009

Parameters as interpreted:
	--vcf AA261.HostPlantOutlierScaffolds.recode.vcf
	--keep keep.HostPlant
	--recode-INFO-all
	--out AA250.HostPlantOutlierScaffolds
	--recode

Keeping individuals in 'keep' list
After filtering, kept 250 out of 261 Individuals
Outputting VCF file...
After filtering, kept 109 out of a possible 109 Sites
Run Time = 2.00 seconds
AJvR:fineRADstructure alexjvr$ vcftools --vcf AA250.HostPlantOutlierScaffolds.recode.vcf --max-missing 0.5

VCFtools - v0.1.14
(C) Adam Auton and Anthony Marcketta 2009

Parameters as interpreted:
	--vcf AA250.HostPlantOutlierScaffolds.recode.vcf
	--max-missing 0.5

After filtering, kept 250 out of 250 Individuals
After filtering, kept 109 out of a possible 109 Sites
Run Time = 1.00 seconds
```


ColHist
```
vcftools --vcf AA261.newnames.vcf --chr contig_1784 --chr contig_5345 --chr contig_16912 --chr contig_3360 --chr contig_19343 --chr contig_59667 --chr contig_24918 --chr contig_3838 --chr contig_18281 --chr contig_1883 --chr contig_19566 --chr contig_19564 --recode --recode-INFO-all --out AA261.ColHistOutlierScaffolds


VCFtools - v0.1.14
(C) Adam Auton and Anthony Marcketta 2009

Parameters as interpreted:
	--vcf AA261.newnames.vcf
	--chr contig_16912
	--chr contig_1784
	--chr contig_18281
	--chr contig_1883
	--chr contig_19343
	--chr contig_19564
	--chr contig_19566
	--chr contig_24918
	--chr contig_3360
	--chr contig_3838
	--chr contig_5345
	--chr contig_59667
	--recode-INFO-all
	--out AA261.ColHistOutlierScaffolds
	--recode

After filtering, kept 261 out of 261 Individuals
Outputting VCF file...
After filtering, kept 169 out of a possible 31381 Sites
Run Time = 4.00 seconds

##Remove indivs with >50% missing data
vcftools --vcf AA261.ColHistOutlierScaffolds.recode.vcf --keep keep.indivs --recode --recode-INFO-all --out AA254.ColHistOutlierScaffolds

VCFtools - v0.1.14
(C) Adam Auton and Anthony Marcketta 2009

Parameters as interpreted:
	--vcf AA261.ColHistOutlierScaffolds.recode.vcf
	--keep keep.indivs
	--recode-INFO-all
	--out AA254.ColHistOutlierScaffolds
	--recode

Keeping individuals in 'keep' list
After filtering, kept 254 out of 261 Individuals
Outputting VCF file...
After filtering, kept 169 out of a possible 169 Sites
Run Time = 2.00 seconds
AJvR:fineRADstructure alexjvr$ vcftools --vcf AA254.ColHistOutlierScaffolds.recode.vcf --max-missing 0.5

VCFtools - v0.1.14
(C) Adam Auton and Anthony Marcketta 2009

Parameters as interpreted:
	--vcf AA254.ColHistOutlierScaffolds.recode.vcf
	--max-missing 0.5

After filtering, kept 254 out of 254 Individuals
After filtering, kept 169 out of a possible 169 Sites
Run Time = 0.00 seconds

```

Convert to fineRADstructure input
```
./vcf2hapmatrix.py AA261.ColHistOutlierScaffolds.recode.vcf > AA261.ColHistOutliers.fineradstr
./vcf2hapmatrix.py AA261.HostPlantOutlierScaffolds.recode.vcf > AA261.HostPlantOutliers.fineradstr

##with indivs removed
./vcf2hapmatrix.py AA254.ColHistOutlierScaffolds.recode.vcf > AA254.ColHistOutliers.fineradstr
./vcf2hapmatrix.py AA250.HostPlantOutlierScaffolds.recode.vcf > AA250.HostPlantOutlierScaffolds.fineradstr
```


Run fineRADstr
```
./RADpainter paint AA261.HostPlantOutliers.fineradstr 
Painting RAD tags from: AA261.HostPlantOutliers.fineradstr
The file seems to be in a Matrix format
BAR1	nan
BAR1	nan
Printing missingness per individual to: AA261.HostPlantOutliers_missingness.out
Theoretical c = 0.00769231
Jackknife c = nan
notInformative = 0
Printing the final coancestry matrix to AA261.HostPlantOutliers_chunks.out
Analysis completed in: 0.560336 seconds (0.080048 seconds per RAD locus)

```


## Haplotype network of outlier RADtags

Use A. artaxerxes as an outlier. And perhaps a further ancestor with WGS?? 

Identify the scaffolds and region where the outlier loci are. I can see this in my locus.stats file in R

```
getwd()
/Users/alexjvr/2018.postdoc/BrownArgus_2018/201902_DataAnalysis/AdaptationHostPlant

> outliers.HostPlant
                V1    V2                 V3       Agene1 LG_assigned Hmel.pos
2072   m_scaff_962 19860  m_scaff_962_19860 HMEL003137g1          01  3418280
10676 contig_11951 10614 contig_11951_10614         <NA>        <NA>       NA
11041  contig_5345   510    contig_5345_510         <NA>        <NA>       NA
11042  contig_5345   511    contig_5345_511         <NA>        <NA>       NA
11050  contig_5345   587    contig_5345_587         <NA>        <NA>       NA
12108 contig_17378  3882  contig_17378_3882         <NA>        <NA>       NA
16942  contig_5407  5785   contig_5407_5785         <NA>        <NA>       NA
17001 contig_19343  4711  contig_19343_4711         <NA>        <NA>       NA
21375  contig_3838  3376   contig_3838_3376         <NA>        <NA>       NA
21377  contig_3838  3378   contig_3838_3378         <NA>        <NA>       NA
21378  contig_3838  3382   contig_3838_3382         <NA>        <NA>       NA
21379  contig_3838  3408   contig_3838_3408         <NA>        <NA>       NA
26646  contig_2518 13094  contig_2518_13094         <NA>        <NA>       NA
      Bayescan    LG.pos     LFMM.zs   LFMM.invP chr     pos   pvalue
2072  0.075214 1_3418280 -1.29200000 0.852724236   1 3418280 0.075214
10676 0.070423     NA_NA -0.92842900 0.702313781  NA      NA 0.070423
11041 0.090865     NA_NA  0.00963256 0.008620760  NA      NA 0.090865
11042 0.092381     NA_NA  0.00433303 0.003877951  NA      NA 0.092381
11050 0.095242     NA_NA  0.06568980 0.058737760  NA      NA 0.095242
12108 0.082410     NA_NA  1.90364000 0.967262743  NA      NA 0.082410
16942 0.071641     NA_NA  1.39249000 0.881697843  NA      NA 0.071641
17001 0.095215     NA_NA -1.49713000 0.906909006  NA      NA 0.095215
21375 0.095010     NA_NA -0.75066800 0.600220766  NA      NA 0.095010
21377 0.092891     NA_NA -0.73351900 0.589366742  NA      NA 0.092891
21378 0.095510     NA_NA -0.76999000 0.612241154  NA      NA 0.095510
21379 0.089935     NA_NA -0.71849300 0.579714051  NA      NA 0.089935
26646 0.082731     NA_NA -1.31554000 0.859955662  NA      NA 0.082731
      BayescanColHist
2072         0.022119
10676        0.022163
11041        0.083876
11042        0.083073
11050        0.085587
12108        0.021469
16942        0.031380
17001        0.083373
21375        0.105340
21377        0.104240
21378        0.109400
21379        0.100140
26646        0.073927

```

Here I can see the scaffold and approximate position of the RAD tag of interest. Extract all these tags from the mapped bam files for the population data. 
This is done on the blue crystal server. 

```
pwd
#/newhome/aj18951/1a_Aricia_agestis_PopGenomics/mapped

module load apps/samtools-1.8
module load apps/bamtools-1.8
for i in $(ls *gz.bam); do samtools view -b -F4 $i m_scaff_962:19000-20000 >> $i.m_scaff_962.subset.bam; done
##remember -F4 to filter for properly paired and mapped reads only. 

```

And a script if you provide a list of scaffolds and positions
```

```



## Haplotype network of outliers vs overall

I will extract all the outliers from the vcf file and draw a haplotype network for this in R. 


Create a vcf file for each of the scaffolds/contigs that outliers appear on: 
```
##Hostplant

vcftools --vcf AA261.newnames.vcf --chr contig_5345 --chr contig_17378 --chr contig_5407 --chr contig_19343 --chr contig_3838 --chr contig_2518 --chr m_scaff_962 --chr contig_11951 --recode --recode-INFO-all --out AA261.HostPlant.contig_5345


vcftools --vcf AA250.HostPlantOutlierScaffolds.recode.vcf --chr contig_5345 --recode --recode-INFO-all --out AA250.HostPlant.contig_5345

VCFtools - v0.1.12b
(C) Adam Auton and Anthony Marcketta 2009

Parameters as interpreted:
	--vcf AA250.HostPlantOutlierScaffolds.recode.vcf
	--chr contig_5345
	--recode-INFO-all
	--out AA250.HostPlant.contig_5345
	--recode

After filtering, kept 250 out of 250 Individuals
Outputting VCF file...
After filtering, kept 11 out of a possible 109 Sites
Run Time = 3.00 seconds

```


I've uploaded these onto bluecrystal
```
pwd

/newhome/aj18951/1a_Aricia_agestis_PopGenomics/HaplotypeNetwork

ls

AA250.HostPlantOutlierScaffolds.recode.vcf  
AA254.ColHistOutlierScaffolds.recode.vcf

```

Phase these individual vcf files
```
module load languages/java-jdk-11.0.3

module load apps/beagle-4.1

#once loaded most of the shared packages can be found here: /cm/shared/apps/ 

##Check that beagle is working

java -jar /cm/shared/apps/Beagle-4.1/beagle.jar


#Phase the first vcf file

java -jar /cm/shared/apps/Beagle-4.1/beagle.jar gt=AA250.HostPlant.contig_5345.recode.vcf out=AA250.contig_5345.Beagle

gunzip AA250.contig_5345.Beagle.vcf.gz 
```

Extract fasta sequences: 
```
module load apps/bcftools-1.8

for i in $(bcftools query -l AA250.contig_5345.Beagle.vcf); do printf '>'${i}'\n'; bcftools query -s ${i} -f '[%TGT]' AA250.contig_5345.Beagle.vcf; printf '\n'; done > test.fa


##write haplotype1 to file
awk -F"_" '{print substr($1,1,1)substr($2,2,2)substr($3,2,2)substr($4,2,2)substr($5,2,2)substr($6,2,2)substr($7,2,2)substr($8,2,2)substr($9,2,2)substr($10,2,2)}' hap1.fa

#Or do it all together: 
for i in $(bcftools query -l AA250.contig_5345.Beagle.vcf); do printf '>'${i}'\n'; bcftools query -s ${i} -f '[%TGT]' AA250.contig_5345.Beagle.vcf | awk -F"|" '{print substr($1,1,1)substr($2,2,2)substr($3,2,2)substr($4,2,2)substr($5,2,2)substr($6,2,2)substr($7,2,2)substr($8,2,2)substr($9,2,2)substr($10,2,2)substr($11,2,2)}'; printf '\n'; done > loc1.allele1

##Add ".1" to all the names
sed -E -i 's:^>.+:&.1:g' loc1.allele1


for i in $(bcftools query -l AA250.contig_5345.Beagle.vcf); do printf '>'${i}'\n'; bcftools query -s ${i} -f '[%TGT]' AA250.contig_5345.Beagle.vcf | awk -F"|" '{print substr($2,1,1)substr($3,1,1)substr($4,1,1)substr($5,1,1)substr($6,1,1)substr($7,1,1)substr($8,1,1)substr($9,1,1)substr($10,1,1)substr($11,1,1)}'; printf '\n'; done > loc1.allele2

##Add ".2" to all the names
sed -E -i 's:^>.+:&.2:g' loc1.allele2

##create one file. And remove all white spaces

cat loc1.allele1 loc1.allele2 > loc1.haplotypes
sed -i '/^$/d' loc1.haplotypes 
```


The haplotype network will be constructed in R using pegas
```
library(pegas)
loc1.fa <- read.FASTA("loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

loc1.popnames <- read.table("loc1.popnames", header=F)  ##read in file with pop info
      V1  V2       V3  V4  V5
1 BAR1.1 BAR Rockrose new new
2 BAR2.1 BAR Rockrose new new
3 BAR3.1 BAR Rockrose new new
4 BAR4.1 BAR Rockrose new new
5 BAR5.1 BAR Rockrose new new
6 BAR6.1 BAR Rockrose new new

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), 
table(hap=ind, pop=loc1.popnames$V5))     ##create a table to count haplotypes in each catagory

ind.hap

      pop
hap    established new
  I            138  82
  II             0  40
  III           94  34
  IV             6  18
  V             34   7
  VI             4  30
  VII            0   5
  VIII           0   5
  IX             0   2
  X              0   1


plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap)  
legend(1,10, colnames(ind.hap), col=rainbow(ncol(ind.hap)), pch=20)

##To add info about HOD

three.colours <- c("gold1", "gold3", "darkorchid")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=three.colours)
legend(1,10, colnames(ind.hap), col=three.colours, pch=20)
```


Try this for the rest of the contigs/scaffolds: 
```
vcftools --vcf AA250.HostPlantOutlierScaffolds.recode.vcf --chr contig_17378 --recode --recode-INFO-all --out AA250.HostPlant.contig_17378
After filtering, kept 1 out of a possible 109 Sites


vcftools --vcf AA250.HostPlantOutlierScaffolds.recode.vcf --chr contig_5407 --recode --recode-INFO-all --out AA250.HostPlant.contig_5407
After filtering, kept 11 out of a possible 109 Sites


vcftools --vcf AA250.HostPlantOutlierScaffolds.recode.vcf --chr contig_19343 --recode --recode-INFO-all --out AA250.HostPlant.contig_19343
After filtering, kept 6 out of a possible 109 Sites


vcftools --vcf AA250.HostPlantOutlierScaffolds.recode.vcf --chr contig_3838 --recode --recode-INFO-all --out AA250.HostPlant.contig_3838
After filtering, kept 38 out of a possible 109 Sites


vcftools --vcf AA250.HostPlantOutlierScaffolds.recode.vcf --chr contig_2518 --recode --recode-INFO-all --out AA250.HostPlant.contig_2518
After filtering, kept 30 out of a possible 109 Sites


vcftools --vcf AA250.HostPlantOutlierScaffolds.recode.vcf --chr m_scaff_962 --recode --recode-INFO-all --out AA250.HostPlant.m_scaff_962
After filtering, kept 5 out of a possible 109 Sites


vcftools --vcf AA250.HostPlantOutlierScaffolds.recode.vcf --chr contig_11951 --recode --recode-INFO-all --out AA250.HostPlant.contig_11951
After filtering, kept 7 out of a possible 109 Sites

vcftools --vcf AA250.HostPlantOutlierScaffolds.recode.vcf --chr m_scaff_962 --recode --recode-INFO-all --out AA250.HostPlant.m_scaff_962
After filtering, kept 5 out of a possible 109 Sites

```


Make sure that all the loci are likely to be linked. Check if loci are within 10kb of each other: 
```
for i in $(ls *contig*vcf); do vcftools --vcf $i --thin 10000; done

##all outputs should filter down to 1 variant per file. Otherwise check how far apart they are. 
```

Phase with beagle
```
for i in $(ls *contig*vcf); do java -jar /cm/shared/apps/Beagle-4.1/beagle.jar gt=$i out=$i.beagle; done

##remove the file that has only 1 variant site

rm AA250.HostPlant.contig_17378.recode.vcf

##phase the file with scaffold
java -jar /cm/shared/apps/Beagle-4.1/beagle.jar gt=AA250.HostPlant.m_scaff_962.recode.vcf out=AA250.HostPlant.m_scaff_962.recode.vcf.beagle

##unzip all
for i in $(ls *gz); do gunzip $i; done
```

Extract fasta sequences for all: 
```
module load apps/bcftools-1.8

for i in $(bcftools query -l AA250.contig_5345.Beagle.vcf); do printf '>'${i}'\n'; bcftools query -s ${i} -f '[%TGT]' AA250.contig_5345.Beagle.vcf; printf '\n'; done > test.fa


##write haplotype1 to file
awk -F"|" '{print substr($1,1,1)substr($2,2,2)substr($3,2,2)substr($4,2,2)substr($5,2,2)substr($6,2,2)substr($7,2,2)substr($8,2,2)substr($9,2,2)substr($10,2,2)}' hap1.fa

#Or do it all together: 
for i in $(bcftools query -l AA250.contig_5345.Beagle.vcf); do printf '>'${i}'\n'; bcftools query -s ${i} -f '[%TGT]' AA250.contig_5345.Beagle.vcf | awk -F"|" '{print substr($1,1,1)substr($2,2,2)substr($3,2,2)substr($4,2,2)substr($5,2,2)substr($6,2,2)substr($7,2,2)substr($8,2,2)substr($9,2,2)substr($10,2,2)substr($11,2,2)}'; printf '\n'; done > loc1.allele1

##Add ".1" to all the names
sed -E -i 's:^>.+:&.1:g' loc1.allele1


for i in $(bcftools query -l AA250.contig_5345.Beagle.vcf); do printf '>'${i}'\n'; bcftools query -s ${i} -f '[%TGT]' AA250.contig_5345.Beagle.vcf | awk -F"|" '{print substr($2,1,1)substr($3,1,1)substr($4,1,1)substr($5,1,1)substr($6,1,1)substr($7,1,1)substr($8,1,1)substr($9,1,1)substr($10,1,1)substr($11,1,1)}'; printf '\n'; done > loc1.allele2

##Add ".2" to all the names
sed -E -i 's:^>.+:&.2:g' loc1.allele2

##create one file. And remove all white spaces

cat loc1.allele1 loc1.allele2 > loc1.haplotypes
sed -i '/^$/d' loc1.haplotypes 
```

Create plots for every haplotype 
```


ind.hap.2518 <- with(stack(setNames(attr(h2518, "index"), rownames(h2518))), table(hap=ind, pop=loc1.popnames$V5))
plot(net.h2518, scale.ratio=1, cex=0.8, pie=ind.hap.2518, bg=three.colours)
pdf("contig_2518.pdf")
plot(net.h2518, scale.ratio=1, cex=0.8, pie=ind.hap.2518, bg=three.colours)
legend(10,10, colnames(ind.hap.2518), col=three.colours, pch=20)
title("contig_2518")


```

Colour by population
```
ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), 
table(hap=ind, pop=loc1.popnames$V2))

plot(net, size=attr(net, "freq"), scale.ratio = 2, cex = 0.8, pie=ind.map)
legend(50,50, colnames(ind.hap), col=rainbow(ncol(ind.map)), pch=20)
```

### Neutral haplotypes

Compare these haplotype networks with a set of random loci from the genome. 

First extract the names of all the loci from the vcf file
```
On bluecp3: /newhome/aj18951/1a_Aricia_agestis_PopGenomics/HaplotypeNetwork

module load apps/vcftools-0.1.12b

grep "^contig" AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf | awk '{print $1}' | awk '!a[$0]++' >> contig.names.neutral20
shuf -n20 contig.names.neutral >> contig.names.neutral20

cat contig.names.neutral20 
contig_10072
contig_12160
contig_10272
contig_18932
contig_4506
contig_2942
contig_2229
contig_37637
contig_25996
contig_662
contig_58892
contig_38039
contig_75445
contig_10781
contig_1985
contig_30084
contig_31360
contig_3461
contig_916
contig_2334
```

Extract all the contigs/scaffolds: 
```
vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_10072 --recode --recode-INFO-all --out AA250.HostPlant.contig_10072
After filtering, kept 16 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_12160 --recode --recode-INFO-all --out AA250.HostPlant.contig_12160
After filtering, kept 8 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_10272 --recode --recode-INFO-all --out AA250.HostPlant.contig_10272
After filtering, kept 3 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_18932 --recode --recode-INFO-all --out AA250.HostPlant.contig_18932
After filtering, kept 3 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_4506 --recode --recode-INFO-all --out AA250.HostPlant.contig_4506
After filtering, kept 7 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_2942 --recode --recode-INFO-all --out AA250.HostPlant.contig_2942
After filtering, kept 33 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_2229 --recode --recode-INFO-all --out AA250.HostPlant.contig_2229
After filtering, kept 6 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_37637 --recode --recode-INFO-all --out AA250.HostPlant.contig_37637
After filtering, kept 1 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_25996 --recode --recode-INFO-all --out AA250.HostPlant.contig_25996
After filtering, kept 3 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_662 --recode --recode-INFO-all --out AA250.HostPlant.contig_662
After filtering, kept 2 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_58892 --recode --recode-INFO-all --out AA250.HostPlant.contig_58892
After filtering, kept 13 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_38039 --recode --recode-INFO-all --out AA250.HostPlant.contig_38039
After filtering, kept 4 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_75445 --recode --recode-INFO-all --out AA250.HostPlant.contig_75445
After filtering, kept 2 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_10781 --recode --recode-INFO-all --out AA250.HostPlant.contig_10781
After filtering, kept 17 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_1985 --recode --recode-INFO-all --out AA250.HostPlant.contig_1985
After filtering, kept 9 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_30084 --recode --recode-INFO-all --out AA250.HostPlant.contig_30084
After filtering, kept 1 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_31360 --recode --recode-INFO-all --out AA250.HostPlant.contig_31360
After filtering, kept 5 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_3461 --recode --recode-INFO-all --out AA250.HostPlant.contig_3461
After filtering, kept 7 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_916 --recode --recode-INFO-all --out AA250.HostPlant.contig_916
After filtering, kept 1 out of a possible 18338 Sites

vcftools --vcf AA261.0.5miss.9popsMerged.MAF0.05.recode.vcf --chr contig_2334 --recode --recode-INFO-all --out AA250.HostPlant.contig_2334
After filtering, kept 1 out of a possible 18338 Sites
```

Make sure that all the loci are likely to be linked. Check if loci are within 10kb of each other: 
```
for i in $(cat contig.names.neutral20); do vcftools --vcf $i --thin 10000; done

##all outputs should filter down to 1 variant per file. Otherwise check how far apart they are. 
```

Phase with beagle
```
module load languages/java-jdk-11.0.3

module load apps/beagle-4.1

#once loaded most of the shared packages can be found here: /cm/shared/apps/ 

##Check that beagle is working

java -jar /cm/shared/apps/Beagle-4.1/beagle.jar

## Phasing
for i in $(cat contig.names.neutral20); do java -jar /cm/shared/apps/Beagle-4.1/beagle.jar gt=$i out=$i.beagle; done

##remove the file that has only 1 variant site

rm AA250.HostPlant.contig_17378.recode.vcf

##move all to a new folder for Neutral Haplotypes
for i in $(cat contig.names.neutral20); do mv $i NeutralHaplotypes/; done
mv *gz NeutralHaplotypes/


##unzip all
pwd 
/newhome/aj18951/1a_Aricia_agestis_PopGenomics/HaplotypeNetwork/Neutral.Haplotypes
for i in $(ls *gz); do gunzip $i; done
```

Extract fasta sequences for all: 
```
module load apps/bcftools-1.8

for i in $(bcftools query -l AA250.contig_5345.Beagle.vcf); do printf '>'${i}'\n'; bcftools query -s ${i} -f '[%TGT]' AA250.contig_5345.Beagle.vcf; printf '\n'; done > test.fa


##write haplotype1 to file
awk -F"|" '{print substr($1,1,1)substr($2,2,2)substr($3,2,2)substr($4,2,2)substr($5,2,2)substr($6,2,2)substr($7,2,2)substr($8,2,2)substr($9,2,2)substr($10,2,2)}' hap1.fa

#Or do it all together: 
for i in $(bcftools query -l AA250.contig_5345.Beagle.vcf); do printf '>'${i}'\n'; bcftools query -s ${i} -f '[%TGT]' AA250.contig_5345.Beagle.vcf | awk -F"|" '{print substr($1,1,1)substr($2,2,2)substr($3,2,2)substr($4,2,2)substr($5,2,2)substr($6,2,2)substr($7,2,2)substr($8,2,2)substr($9,2,2)substr($10,2,2)substr($11,2,2)}'; printf '\n'; done > loc1.allele1

##Add ".1" to all the names
sed -E -i 's:^>.+:&.1:g' loc1.allele1


for i in $(bcftools query -l AA250.contig_5345.Beagle.vcf); do printf '>'${i}'\n'; bcftools query -s ${i} -f '[%TGT]' AA250.contig_5345.Beagle.vcf | awk -F"|" '{print substr($2,1,1)substr($3,1,1)substr($4,1,1)substr($5,1,1)substr($6,1,1)substr($7,1,1)substr($8,1,1)substr($9,1,1)substr($10,1,1)substr($11,1,1)}'; printf '\n'; done > loc1.allele2

##Add ".2" to all the names
sed -E -i 's:^>.+:&.2:g' loc1.allele2

##create one file. And remove all white spaces

cat loc1.allele1 loc1.allele2 > loc1.haplotypes
sed -i '/^$/d' loc1.haplotypes 
```

Simple script for this: [ExtractHaplotypes.sh](https://github.com/alexjvr1/AriciaAgestis_PopGenMS/blob/master/ExtractHaplotypes.sh)

Create plots for every haplotype. 

First copy all the fasta files onto the mac
```
pwd /Users/alexjvr/2018.postdoc/BrownArgus_2018/201902_DataAnalysis/HaplotypNetworkOutliers/NeutralLoci

scp bluecp3:/newhome/aj18951/1a_Aricia_agestis_PopGenomics/HaplotypeNetwork/Neutral.Haplotypes/popnames.info .
scp bluecp3:/newhome/aj18951/1a_Aricia_agestis_PopGenomics/HaplotypeNetwork/Neutral.Haplotypes/*loc1.allele* .
```

Networks will be drawn in R
```
library(pegas)
loc1.fa <- read.FASTA("AA250.HostPlant.contig_10072.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

loc1.popnames <- read.table("popnames.info", header=F)  ##read in file with pop info. The names are doubled because there are two alleles. ie. all names + all names (not interleaved)
           V1  V2       V3  V4  V5
1 BAR_10_2013 BAR Rockrose new new
2 BAR_11_2014 BAR Rockrose new new
3 BAR_12_2013 BAR Rockrose new new
4 BAR_13_2014 BAR Rockrose new new
5 BAR_14_2013 BAR Rockrose new new
6 BAR_14_2014 BAR Rockrose new new
```

Plot
```
##create a table to count haplotypes in each catagory
ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

     pop
hap   established established.HOD new
  I            79              30  47
  II          131              30 136
  III          26               0  17
  IV            0               0  23
  V             0               0   1
  VI            0               0   2



pdf("haplotypenet_contig_10272.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(-5,-2, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_10272: 3 SNPs") ##change the title for each plot
dev.off()
And repeat for all the haplotypes. All figures are saved here on the mac: /Users/alexjvr/2018.postdoc/BrownArgus_2018/201902_DataAnalysis/HaplotypNetworkOutliers/NeutralLoci
#####DNA sequences not of the same length
##contig_10072

loc1.fa <- read.FASTA("AA250.HostPlant.contig_10072.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

     pop
hap   established established.HOD new
  I            79              30  47
  II          131              30 136
  III          26               0  17
  IV            0               0  23
  V             0               0   1
  VI            0               0   2


pdf("haplotypenet_contig_10072.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(-5,-2, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_10072: 3 SNPs") ##change the title for each plot
dev.off()

#####DNA sequences not of the same length
##contig_10781

loc1.fa <- read.FASTA("AA250.HostPlant.contig_10781.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

     pop
hap   established established.HOD new
  I            79              30  47
  II          131              30 136
  III          26               0  17
  IV            0               0  23
  V             0               0   1
  VI            0               0   2


pdf("haplotypenet_contig_10781.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(-5,-2, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_10781: 3 SNPs") ##change the title for each plot
dev.off()

######Error DNA sequences not of same length
##contig_2942

loc1.fa <- read.FASTA("AA250.HostPlant.contig_2942.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

     pop
hap   established established.HOD new
  I            79              30  47
  II          131              30 136
  III          26               0  17
  IV            0               0  23
  V             0               0   1
  VI            0               0   2


pdf("haplotypenet_contig_2942.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(-5,-2, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_2942: 3 SNPs") ##change the title for each plot
dev.off()

#####Error DNA sequences not the same length
##contig_58892 

loc1.fa <- read.FASTA("AA250.HostPlant.contig_58892.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

     pop
hap   established established.HOD new
  I            79              30  47
  II          131              30 136
  III          26               0  17
  IV            0               0  23
  V             0               0   1
  VI            0               0   2


pdf("haplotypenet_contig_58892.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(-5,-2, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_58892: 3 SNPs") ##change the title for each plot
dev.off()







##contig_12160

loc1.fa <- read.FASTA("AA250.HostPlant.contig_12160.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

      pop
hap    established established.HOD new
  I             48               0  45
  II           108              30 113
  III           20               6   0
  IV            21              24   8
  V             15               0  17
  VI             3               0   0
  VII           21               0  15
  VIII           0               0   6
  IX             0               0  14
  X              0               0   3
  XI             0               0   1
  XII            0               0   1
  XIII           0               0   1
  XIV            0               0   1
  XV             0               0   1

pdf("haplotypenet_contig_12160.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(4,-2, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_12160: 8 SNPs") ##change the title for each plot
dev.off()


##contig_18932

loc1.fa <- read.FASTA("AA250.HostPlant.contig_18932.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

     pop
hap   established established.HOD new
  I           134              30 141
  II           22               0  10
  III          73              30  32
  IV            7               0  43


pdf("haplotypenet_contig_18932.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(1,1, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_18932: 3 SNPs") ##change the title for each plot
dev.off()

##contig_1985

loc1.fa <- read.FASTA("AA250.HostPlant.contig_1985.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

ind.hap
      pop
hap    established established.HOD new
  I             56               0  45
  II            53              30  25
  III           51               0  88
  IV             2               0   0
  V             29              30   0
  VI            16               0  25
  VII            5               0   0
  VIII          24               0  12
  IX             0               0   1
  X              0               0  15
  XI             0               0   1
  XII            0               0  10
  XIII           0               0   2
  XIV            0               0   1
  XV             0               0   1


pdf("haplotypenet_contig_1985.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(5,8, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_1985: 9 SNPs") ##change the title for each plot
dev.off()

##contig_2229

loc1.fa <- read.FASTA("AA250.HostPlant.contig_2229.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

      pop
hap    established established.HOD new
  I            118              30 125
  II           114              30  58
  III            4               0  20
  IV             0               0  16
  V              0               0   2
  VI             0               0   3
  VII            0               0   1
  VIII           0               0   1


pdf("haplotypenet_contig_2229.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(3,5, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_2229: 6 SNPs") ##change the title for each plot
dev.off()

##contig_2334 - dropped because only one SNP

loc1.fa <- read.FASTA("AA250.HostPlant.contig_2334.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     
 
 pop
hap  established established.HOD new
  I          197              60 161
  II          39               0  65

pdf("haplotypenet_contig_2334.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(0,1, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_2334: 1 SNP") ##change the title for each plot
dev.off()

##contig_25996

loc1.fa <- read.FASTA("AA250.HostPlant.contig_25996.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

     pop
hap   established established.HOD new
  I           118              30  90
  II          118              30  99
  III           0               0  12
  IV            0               0   9
  V             0               0  16



pdf("haplotypenet_contig_25996.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(-5,-2, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_25996: 3 SNPs") ##change the title for each plot
dev.off()


##contig_30084 - Dropped because just one SNP

loc1.fa <- read.FASTA("AA250.HostPlant.contig_30084.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

   pop
hap  established established.HOD new
  I          236              60 197
  II           0               0  29
  
pdf("haplotypenet_contig_30084.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(-5,-2, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_30084: 1 SNPs") ##change the title for each plot
dev.off()



##contig_31360

loc1.fa <- read.FASTA("AA250.HostPlant.contig_31360.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

      pop
hap    established established.HOD new
  I             23               0  28
  II            95              30 111
  III           51               0  19
  IV             1               0   0
  V              6              30   0
  VI            35               0  25
  VII           12               0   0
  VIII          13               0   3
  IX             0               0  34
  X              0               0   1
  XI             0               0   5


pdf("haplotypenet_contig_31360.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(-8,2, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_31360: 5 SNPs") ##change the title for each plot
dev.off()

##contig_3461

loc1.fa <- read.FASTA("AA250.HostPlant.contig_3461.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

      pop
hap    established established.HOD new
  I             56               0  45
  II           125              60 113
  III           13               0   0
  IV             3               0  12
  V             10               0  13
  VI             2               0   0
  VII            6               0   0
  VIII           3               0   0
  IX             7               0   0
  X             11               0  21
  XI             0               0  10
  XII            0               0   2
  XIII           0               0   6
  XIV            0               0   1
  XV             0               0   1
  XVI            0               0   1
  XVII           0               0   1


pdf("haplotypenet_contig_3461.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(-10,-2, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_3461: 7 SNPs") ##change the title for each plot
dev.off()

##contig_37637 - Dropped because just one SNP

loc1.fa <- read.FASTA("AA250.HostPlant.contig_37637.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

   pop
hap  established established.HOD new
  I          192              60 158
  II          44               0  68


pdf("haplotypenet_contig_37637.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(0,1, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_37637: 1 SNPs") ##change the title for each plot
dev.off()

##contig_28039

loc1.fa <- read.FASTA("AA250.HostPlant.contig_38039.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

     pop
hap   established established.HOD new
  I            16               0  28
  II          220              60 169
  III           0               0  29



pdf("haplotypenet_contig_38039.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(-5,-2, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_38039: 4 SNPs") ##change the title for each plot
dev.off()

##contig_4506

loc1.fa <- read.FASTA("AA250.HostPlant.contig_4506.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

     pop
hap     established established.HOD new
  I              58               6  45
  II              0               4   0
  III            80              20  96
  IV             25               0  17
  V               5               0   0
  VI             24              30   0
  VII            25               0  25
  VIII           14               0   0
  IX              1               0   0
  X               4               0   8
  XI              0               0   6
  XII             0               0   4
  XIII            0               0   1
  XIV             0               0   1
  XV              0               0   5
  XVI             0               0   1
  XVII            0               0   3
  XVIII           0               0   2
  XIX             0               0   1
  XX              0               0   5
  XXI             0               0   5
  XXII            0               0   1


pdf("haplotypenet_contig_4506.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(-12,-4, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_4506: 7 SNPs") ##change the title for each plot
dev.off()


##contig_662

loc1.fa <- read.FASTA("AA250.HostPlant.contig_662.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

     pop
hap   established established.HOD new
  I           102              30  70
  II           74              21  88
  III          60               9  68


pdf("haplotypenet_contig_662.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(1,2, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_662: 2 SNPs") ##change the title for each plot
dev.off()

##contig_75445

loc1.fa <- read.FASTA("AA250.HostPlant.contig_75445.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

     pop
hap   established established.HOD new
  I            38               0  28
  II          193              60 155
  III           5               0  43


pdf("haplotypenet_contig_75445.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(-2,2, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_75445: 2 SNPs") ##change the title for each plot
dev.off()

##contig_916 - Dropped because only one SNP

loc1.fa <- read.FASTA("AA250.HostPlant.contig_916.recode.vcf.beagle.vcf.loc1.haplotypes")
h <- haplotype(loc1.fa)
net <- haploNet(h)
plot(net)

ind.hap<-with(stack(setNames(attr(h, "index"), rownames(h))), table(hap=ind, pop=loc1.popnames$V3))     

ind.hap

    pop
hap  established established.HOD new
  I          118              30 108
  II         118              30 118


pdf("haplotypenet_contig_916.pdf")
four.colours <- c("darkorchid", "red", "gold1", "gold3")
plot(net, scale.ratio = 2, cex = 0.8, pie=ind.hap, bg=four.colours)
legend(-2,1, colnames(ind.hap), col=four.colours, pch=20)  ##The legend needs to be moved for each plot
title("contig_916: 1 SNPs") ##change the title for each plot
dev.off()
```


